<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUMENDROP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #16C79A;
            --support-green: #118C6B;
            --white: #FFFFFF;
            --soft-gray: #F2F4F6;
            --charcoal: #2E2E2E;
            --light-red: #FEE2E2;
            --dark-red: #B91C1C;
            --light-green: #D1FAE5;
            --dark-green: #065F46;
        }
        body { margin: 0; font-family: 'Inter', sans-serif; color: var(--charcoal); display: flex; flex-direction: column; min-height: 100vh; overflow-x: hidden; background-color: var(--white); background-image: url('blob-green.svg'), url('blob-dark-green.svg'), radial-gradient(var(--charcoal) 0.5px, transparent 0), linear-gradient(180deg, var(--soft-gray) 0%, var(--white) 25%); background-repeat: no-repeat, no-repeat, repeat, no-repeat; background-position: top -20vw left -20vw, bottom -20vw right -20vw, 0 0, 0 0; background-size: 50vw, 45vw, 15px 15px, auto; }
        .page-wrapper { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; position: relative; z-index: 2; padding: 20px; }
        .logo { position: absolute; top: 30px; left: 50%; transform: translateX(-50%); font-weight: 700; letter-spacing: 1px; font-size: 16px; color: var(--charcoal); text-decoration: none; cursor: pointer; z-index: 1001; }
        .headline { font-size: 5rem; font-weight: 700; line-height: 1.1; margin: 20px 0; color: var(--charcoal); }
        .headline .subtitle { display: block; color: var(--support-green); font-weight: 500; margin-top: 10px; }
        .btn { display: inline-block; text-decoration: none; font-weight: 500; border-radius: 9999px; padding: 12px 28px; cursor: pointer; border: none; transition: all 0.2s ease-in-out; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .btn-primary { background-color: var(--primary-green); color: var(--white); font-size: 16px; }
        .btn-primary:hover { background-color: var(--support-green); }
        .navbar-container { position: fixed; bottom: 20px; left: 0; width: 100%; display: flex; justify-content: center; z-index: 1000; }
        .floating-navbar { display: flex; align-items: center; justify-content: space-between; width: 100%; max-width: 600px; background-color: var(--soft-gray); padding: 8px 15px; border-radius: 9999px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB; }
        .navbar-links, .navbar-user-actions { display: flex; align-items: center; gap: 15px; }
        .floating-navbar a { text-decoration: none; color: var(--charcoal); font-size: 15px; font-weight: 500; padding: 8px 12px; transition: color 0.2s ease; white-space: nowrap; }
        .floating-navbar a:hover { color: var(--primary-green); }
        .navbar-btn { background-color: var(--primary-green); color: var(--white); font-size: 14px; padding: 10px 20px; }
        .streak-btn { display: flex; align-items: center; gap: 5px; font-weight: 700; padding: 8px; }
        #streak-icon { width: 20px; height: 20px; vertical-align: middle; }
        .profile-photo { width: 36px; height: 36px; border-radius: 50%; border: 2px solid var(--white); object-fit: cover; cursor: pointer; }
        .content-section { display: none; padding: 40px 50px; text-align: center; max-width: 900px; margin: 0 auto; background-color: var(--white); border-radius: 16px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); transform: translateY(20px); opacity: 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; margin: auto; height: fit-content; display: flex; flex-direction: column; justify-content: center; z-index: 500; }
        .content-view { display: none; width: 100%; }
        .content-section h2 { font-size: 2.5rem; margin-bottom: 15px; }
        .topic-selection-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 30px; }
        .topic-tag { background-color: var(--soft-gray); color: var(--charcoal); padding: 12px 25px; border-radius: 9999px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; user-select: none; border: 1px solid transparent; }
        .topic-tag:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); }
        .topic-tag.selected { background-color: var(--primary-green); color: var(--white); }
        .add-topic-container { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; margin-bottom: 40px; height: 48px; }
        #new-topic-input { font-family: 'Inter', sans-serif; font-size: 16px; padding: 12px 20px; border-radius: 9999px; border: 1px solid #d1d5db; width: 300px; transition: border-color 0.2s ease; }
        #add-new-topic-btn { padding: 12px 25px; }
        #save-topics-btn { padding: 10px 20px; font-size: 16px; margin-top: 20px; min-width: unset; width: auto; max-width: 160px; display: block; margin: 20px auto 0 auto; }
        #schedule-view p { margin-bottom: 20px; color: #555; }
        .time-select-container { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-bottom: 40px; }
        #time-select { font-family: 'Inter', sans-serif; font-size: 16px; padding: 12px 20px; border-radius: 8px; border: 1px solid #d1d5db; background-color: var(--soft-gray); cursor: pointer; }
        #confirm-schedule-btn { padding: 15px 35px; font-size: 18px; }
        #test-section .quiz-container p.subtitle { color: #555; margin-bottom: 40px; }
        .question-card { margin-bottom: 30px; text-align: left; border-bottom: 1px solid var(--soft-gray); padding-bottom: 30px; }
        .question-card:last-child { border-bottom: none; }
        .question-text { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; }
        .options-container { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .option { background-color: var(--soft-gray); padding: 15px; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; border: 2px solid transparent; text-align: left; }
        .option.selected { background-color: var(--primary-green); color: var(--white); }
        .option.correct { background-color: var(--light-green); color: var(--dark-green); border-color: var(--support-green); font-weight: 700; }
        .option.incorrect { background-color: var(--light-red); color: var(--dark-red); border-color: #FCA5A5; }
        .quiz-container.answered .option:not(.selected) { opacity: 0.6; }
        #results-text { font-size: 1.5rem; font-weight: 700; margin-top: 30px; display: none; }
        #lockout-view, #success-view { flex-direction: row; align-items: center; justify-content: space-between; gap: 25px; text-align: left; }
        .icon-feedback { width: 50px; height: 50px; flex-shrink: 0; }
        #lockout-view .icon-feedback { color: var(--charcoal); }
        #success-view .icon-feedback { color: var(--primary-green); }
        .lockout-text-content, .success-text-content { flex-grow: 1; }
        #lockout-view h2, #success-view h2 { font-size: 1.8rem; margin: 0 0 5px 0; }
        #lockout-view p, #success-view p { margin: 0; color: #555; line-height: 1.5; }
        .countdown-display { text-align: center; color: var(--dark-red); }
        .countdown-display span { font-size: 1.5rem; font-weight: 700; display: block; }
        #lockout-back-btn, #success-back-btn { width: 110px; height: 110px; padding: 0; font-size: 1rem; line-height: 1.2; flex-shrink: 0; display: flex; align-items: center; justify-content: center; text-align: center; }
        @media (max-width: 768px) { .headline { font-size: 3rem; } .floating-navbar { max-width: 95%; gap: 10px; } .navbar-container { bottom: 10px; } .content-section { padding: 40px 20px; margin: 20px; } .content-section h2 { font-size: 2rem; } #lockout-view, #success-view { flex-direction: column; text-align: center; gap: 20px; } #lockout-back-btn, #success-back-btn { width: 100px; height: 100px; } .add-topic-container { flex-direction: column; height: auto; } #new-topic-input { width: 80%; } }
        .navbar-btn:hover { color: #fff !important; }

        /* New styles for Profile Section */
        #profile-section {
            display: none; /* Hidden by default */
            flex-direction: column;
            align-items: center;
            padding: 40px 50px;
            max-width: 600px;
            text-align: center;
            background-color: var(--white);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            position: fixed;
            top: 50%;
            left: 40%;
            transform: translate(-50%, -50%);
            z-index: 1000; /* Above other content sections */
            height: fit-content;
        }

        #profile-section h2 {
            font-size: 2.2rem;
            margin-bottom: 20px;
            color: var(--charcoal);
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }

        #profile-section .profile-photo {
            width: 80px;
            height: 80px;
            border: 3px solid var(--primary-green);
            margin-bottom: 15px;
        }

        #profile-username {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--charcoal);
            margin-bottom: 5px;
        }

        #profile-email {
            font-size: 1rem;
            color: #777;
        }

        .profile-topics-container {
            width: 100%;
            margin-bottom: 30px;
            text-align: left;
        }

        .profile-topics-container h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--charcoal);
        }

        .profile-topic-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .profile-topic-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--soft-gray);
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .profile-topic-item:last-child {
            margin-bottom: 0;
        }

        .topic-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .topic-info span {
            font-weight: 500;
            color: var(--charcoal);
        }

        .topic-info small {
            font-size: 0.9em;
            color: #777;
        }

        .topic-actions button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            margin-left: 10px;
            color: var(--support-green);
            transition: color 0.2s ease;
        }

        .topic-actions button:hover {
            color: var(--primary-green);
        }

        .topic-actions button.remove-btn {
            color: var(--dark-red);
        }
        .topic-actions button.remove-btn:hover {
            color: #E53935; /* Darker red on hover */
        }
        .profile-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--charcoal);
            transition: color 0.2s ease;
        }
        .profile-close-btn:hover {
            color: var(--dark-red);
        }
        #no-topics-message {
            color: #777;
            font-style: italic;
            margin-top: 15px;
        }
        @media (max-width: 768px) {
            #profile-section {
                padding: 30px 20px;
                max-width: 90%;
            }
            #profile-section h2 {
                font-size: 1.8rem;
            }
            #profile-username {
                font-size: 1.5rem;
            }
            .profile-topic-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
            }
            .topic-actions {
                margin-top: 10px;
                width: 100%;
                display: flex;
                justify-content: flex-end;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
</head>
<body>

    <a href="#home" class="logo">LUMENDROP®</a>

    <main class="page-wrapper">
        <h1 class="headline"><span id="welcome-message">Welcome, User!</span><span class="subtitle">Brighter solutions, every day.</span></h1>
        <a href="#" class="btn btn-primary" id="get-started-btn">Get Started</a>
    </main>

    <section id="your-topic-section" class="content-section">
        <div id="topic-view" class="content-view">
            <h2>Choose Your Interests</h2>
            <p>Select one or more topics to get personalized daily 1-minute AI lessons.</p>
            <div class="topic-selection-grid">
                <div class="topic-tag" data-topic="ai-tech">AI & Tech</div><div class="topic-tag" data-topic="history">History</div><div class="topic-tag" data-topic="science">Science</div><div class="topic-tag" data-topic="mental-health">Mental Health</div><div class="topic-tag" data-topic="productivity">Productivity</div><div class="topic-tag" data-topic="finance">Finance</div><div class="topic-tag" data-topic="design">Design</div><div class="topic-tag" data-topic="philosophy">Philosophy</div><div class="topic-tag" data-topic="space">Space</div><div class="topic-tag" data-topic="marketing">Marketing</div><div class="topic-tag" data-topic="language-learning">Language Learning</div>
            </div>
            <div class="add-topic-container">
                <input type="text" id="new-topic-input" placeholder="Or add your own topic..."><button id="add-new-topic-btn" class="btn btn-primary">Add</button><span id="add-topic-feedback" class="feedback-message">Added!</span>
            </div>
            <button id="save-topics-btn" class="btn btn-primary">Save Topics</button>
        </div>
        <div id="schedule-view" class="content-view">
            <h2>Confirm Your Schedule</h2>
            <p>Your daily drop will be sent to <strong id="user-email"></strong></p>
            <div class="time-select-container">
                <label for="time-select">Preferred Delivery Time:</label><select id="time-select" name="delivery-time"></select>
            </div>
            <button id="confirm-schedule-btn" class="btn btn-primary">Confirm Schedule</button>
        </div>
    </section>

    <section id="test-section" class="content-section">
        <div class="quiz-container content-view">
            <h1>Daily Quiz</h1>
            <p class="subtitle">Test your knowledge from today's lesson.</p>
            <div id="questions-container"><p>Loading your quiz...</p></div>
            <button id="submit-btn" class="btn btn-primary">Submit Answer</button>
            <p id="results-text"></p>
        </div>
        <div id="lockout-view" class="content-view">
            <svg class="icon-feedback" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <div class="lockout-text-content">
                <h2>Not Quite! Take some time to review.</h2>
                <p>To build a strong learning habit, you can try again after the timer runs out. Use this time to review today's lesson in your email.</p>
            </div>
            <div class="countdown-display">Try again in: <span id="countdown-timer">01:00:00</span></div>
            <button id="lockout-back-btn" class="btn btn-primary">Back to Home</button>
        </div>
        <div id="success-view" class="content-view">
            <svg class="icon-feedback" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <div class="success-text-content">
                <h2>Correct! Congratulations!</h2>
                <p>Today's quiz is complete. Your streak has been updated. Come back tomorrow for your next lesson!</p>
            </div>
            <button id="success-back-btn" class="btn btn-primary">Back to Home</button>
        </div>
    </section>

    <section id="profile-section" class="content-section">
        <button class="profile-close-btn" id="profile-close-btn">&times;</button>
        <div class="profile-header">
            <img id="profile-pic-large" src="https://i.pravatar.cc/80" alt="Profile Photo" class="profile-photo">
            <span id="profile-username">Hey, Dhinesh!</span>
            <span id="profile-email-display">dinsee@example.com</span>
        </div>
        <div class="profile-topics-container">
            <h3>Your Topics:</h3>
            <ul id="user-topics-list" class="profile-topic-list">
                </ul>
            <p id="no-topics-message" style="display: none;">You haven't selected any topics yet.</p>
        </div>
    </section>
    
    <div class="navbar-container">
        <nav class="floating-navbar">
            <div class="navbar-links">
                <a href="#home">Home</a>
                <a href="#your-topic">Your Topic</a>
                <a href="#test">Test</a>
            </div>
            <div class="navbar-user-actions">
                <a href="#" class="streak-btn">
                    <img id="streak-icon" src="fire-off.svg" alt="Streak Icon" width="20" height="20">
                    <span id="streak-count">0</span>
                </a>
                <img id="profile-pic" src="https://i.pravatar.cc/40" alt="Profile Photo" class="profile-photo">
                <a href="login.html" class="btn navbar-btn">Log Out</a>
            </div>
        </nav>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script>
        let selectedTopics = new Set();
        let countdownInterval;
        let lastTestState = 'quiz'; // 'quiz', 'success', or 'lockout'
        const mockUserData = {
            name: "Dhinesh", email: "dinsee@example.com", streak: 5,
            profilePictureUrl: "https://i.pravatar.cc/40?img=3",
            savedTopics: [
                { name: "AI & Tech", time: "09:00" },
                { name: "History", time: "14:00" }
            ]
        };
        const mockQuizData = [ { question: "What does 'GPT' stand for in models like GPT-3?", options: ["General Purpose Technology", "Generative Pre-trained Transformer", "Global Positioning Transmitter", "Graphical Processing Toolbox"], correctAnswer: "Generative Pre-trained Transformer" } ];

        function updateProfileUI(userData) {
            document.getElementById('welcome-message').textContent = `Welcome, ${userData.name}!`;
            document.getElementById('profile-pic').src = userData.profilePictureUrl;
            document.getElementById('streak-count').textContent = userData.streak;
            document.getElementById('streak-icon').src = userData.streak > 0 ? 'fire-on.svg' : 'fire-off.svg';

            // Update profile section details
            document.getElementById('profile-pic-large').src = userData.profilePictureUrl.replace('40', '80'); // Larger pic for profile
            document.getElementById('profile-username').textContent = `Hey, ${userData.name}!`;
            document.getElementById('profile-email-display').textContent = userData.email;
            renderUserTopics(userData.savedTopics);
        }
        
        function initializeTopicSelection(savedTopics) {
            const topicTags = document.querySelectorAll('.topic-tag:not(.topic-tag-add)');
            // Convert savedTopics array of objects to a Set of topic names for selection logic
            selectedTopics = new Set(savedTopics.map(topic => topic.name));
            topicTags.forEach(tag => {
                tag.classList.toggle('selected', selectedTopics.has(tag.dataset.topic));
            });
        }
        
        function populateTimeSelect() {
            const timeSelect = document.getElementById('time-select');
            if (!timeSelect) return;
            timeSelect.innerHTML = ''; 
            for (let i = 0; i < 24; i++) {
                let hour = i % 12;
                hour = hour ? hour : 12;
                const ampm = i >= 12 ? 'PM' : 'AM';
                const option = new Option(`${hour}:00 ${ampm}`, `${i.toString().padStart(2, '0')}:00`);
                timeSelect.appendChild(option);
            }
        }
        
        function loadQuiz() {
            const questionsContainer = document.getElementById('questions-container');
            const userAnswers = {};
            if(!questionsContainer) return userAnswers;
            questionsContainer.innerHTML = '';
            mockQuizData.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.dataset.questionIndex = index;
                questionCard.innerHTML = `<p class="question-text">${index + 1}. ${q.question}</p><div class="options-container"></div>`;
                const optionsContainer = questionCard.querySelector('.options-container');
                q.options.forEach(opt => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.textContent = opt;
                    optionDiv.addEventListener('click', () => {
                        if (document.querySelector('.quiz-container').classList.contains('answered')) return;
                        userAnswers[index] = opt;
                        questionCard.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
                        optionDiv.classList.add('selected');
                    });
                    optionsContainer.appendChild(optionDiv);
                });
                questionsContainer.appendChild(questionCard);
            });
            return userAnswers;
        }

        function showLockoutScreen(lockoutEndTime) {
            const testSection = document.getElementById('test-section');
            const quizContainer = document.querySelector('#test-section .quiz-container');
            const lockoutView = document.getElementById('lockout-view');
            const countdownTimer = document.getElementById('countdown-timer');
            gsap.to(quizContainer, {opacity: 0, duration: 0.3, onComplete: () => {
                quizContainer.style.display = 'none';
                lockoutView.style.display = 'flex';
                gsap.fromTo(lockoutView, {opacity: 0, y: 10}, {opacity: 1, y: 0, duration: 0.3});
            }});
            clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = lockoutEndTime - now;
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    countdownTimer.parentElement.innerHTML = "You can try again now!";
                    return;
                }
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                countdownTimer.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        }

        function runPageLoadAnimations() {
            gsap.set(['.logo', '.headline', '.subtitle', '#get-started-btn', '.navbar-container'], { y: 20, opacity: 0 });
            gsap.set(['.profile-photo', '.streak-btn'], { scale: 0.7, opacity: 0 });
            gsap.to('.logo', { y: 0, opacity: 1, duration: 0.7, ease: 'power3.out', delay: 0.2 });
            gsap.to(['.headline', '.subtitle', '#get-started-btn'], { y: 0, opacity: 1, duration: 0.7, stagger: 0.2, ease: 'power3.out', delay: 0.4 });
            gsap.to('.navbar-container', { y: 0, opacity: 1, duration: 0.7, ease: 'power3.out', delay: 0.8 });
            gsap.to(['.streak-btn', '.profile-photo'], { scale: 1, opacity: 1, duration: 0.5, stagger: 0.1, ease: 'back.out(1.7)', delay: 1.2 });

            // Breathing effect for blobs (background images)
            gsap.to('body', {
                '--blob-green-size': '52vw',
                '--blob-dark-green-size': '47vw',
                '--blob-green-pos': 'top -22vw left -22vw',
                '--blob-dark-green-pos': 'bottom -22vw right -22vw',
                duration: 1,
                repeat: -1,
                yoyo: true,
                ease: 'sine.inOut',
                onUpdate: function() {
                    // Animate background-size and background-position using CSS variables
                    document.body.style.backgroundSize = `${getComputedStyle(document.body).getPropertyValue('--blob-green-size')}, ${getComputedStyle(document.body).getPropertyValue('--blob-dark-green-size')}, 15px 15px, auto`;
                    document.body.style.backgroundPosition = `${getComputedStyle(document.body).getPropertyValue('--blob-green-pos')}, ${getComputedStyle(document.body).getPropertyValue('--blob-dark-green-pos')}, 0 0, 0 0`;
                }
            });
            // Set initial CSS variables for blobs
            document.body.style.setProperty('--blob-green-size', '50vw');
            document.body.style.setProperty('--blob-dark-green-size', '45vw');
            document.body.style.setProperty('--blob-green-pos', 'top -20vw left -20vw');
            document.body.style.setProperty('--blob-dark-green-pos', 'bottom -20vw right -20vw');
            document.body.style.backgroundSize = '50vw, 45vw, 15px 15px, auto';
            document.body.style.backgroundPosition = 'top -20vw left -20vw, bottom -20vw right -20vw, 0 0, 0 0';
        }

        // Function to render user's selected topics
        function renderUserTopics(topics) {
            const userTopicsList = document.getElementById('user-topics-list');
            const noTopicsMessage = document.getElementById('no-topics-message');
            userTopicsList.innerHTML = ''; // Clear existing topics

            if (topics.length === 0) {
                noTopicsMessage.style.display = 'block';
                return;
            } else {
                noTopicsMessage.style.display = 'none';
            }

            topics.forEach((topic, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'profile-topic-item';
                listItem.innerHTML = `
                    <div class="topic-info">
                        <span>${topic.name}</span>
                        <small>Daily at ${formatTime(topic.time)}</small>
                    </div>
                    <div class="topic-actions">
                        <button class="edit-topic-btn" data-index="${index}">Edit</button>
                        <button class="remove-topic-btn" data-index="${index}">Remove</button>
                    </div>
                `;
                userTopicsList.appendChild(listItem);
            });

            // Add event listeners for edit and remove buttons
            userTopicsList.querySelectorAll('.edit-topic-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    editTopic(index);
                });
            });

            userTopicsList.querySelectorAll('.remove-topic-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    removeTopic(index);
                });
            });
        }

        // Helper to format time (e.g., "09:00" to "9:00 AM")
        function formatTime(time24) {
            const [hours, minutes] = time24.split(':').map(Number);
            const date = new Date();
            date.setHours(hours, minutes);
            return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
        }

        function editTopic(index) {
            // For simplicity, let's navigate to the "Your Topics" section
            // In a real application, you might show a modal to edit
            // the topic and time directly.
            showSection('your-topic-section');
            const topicToEdit = mockUserData.savedTopics[index];
            if (topicToEdit) {
                // Pre-select the topic if it's one of the default ones, or highlight the input
                document.querySelectorAll('.topic-tag').forEach(tag => {
                    if (tag.dataset.topic === topicToEdit.name.toLowerCase().replace(/ & /g, '-')) {
                        tag.classList.add('selected');
                        selectedTopics.add(tag.dataset.topic);
                    }
                });
                // Set the time in the schedule view
                document.getElementById('time-select').value = topicToEdit.time;
                // Switch to schedule view after selecting topic
                gsap.to(document.getElementById('topic-view'), { opacity: 0, duration: 0.3, onComplete: () => {
                    document.getElementById('topic-view').style.display = 'none';
                    document.getElementById('schedule-view').style.display = 'block';
                    gsap.fromTo(document.getElementById('schedule-view'), {opacity: 0, y: 10}, {opacity: 1, y: 0, duration: 0.3});
                }});
            }
        }

        function removeTopic(index) {
            if (confirm(`Are you sure you want to remove "${mockUserData.savedTopics[index].name}"?`)) {
                mockUserData.savedTopics.splice(index, 1);
                updateProfileUI(mockUserData); // Re-render the topics list
                // Also update the selectedTopics set for the topic selection page
                selectedTopics = new Set(mockUserData.savedTopics.map(topic => topic.name));
                initializeTopicSelection(mockUserData.savedTopics); // Update the topic selection UI
            }
        }

        function setupEventListeners(userData, userAnswers) {
            const mainPageWrapper = document.querySelector('.page-wrapper');
            const contentSections = document.querySelectorAll('.content-section');
            const yourTopicLink = document.querySelector('a[href="#your-topic"]');
            const testLink = document.querySelector('a[href="#test"]');
            const logoLink = document.querySelector('a[href="#home"]');
            const topicView = document.getElementById('topic-view');
            const scheduleView = document.getElementById('schedule-view');
            const saveTopicsBtn = document.getElementById('save-topics-btn');
            const confirmScheduleBtn = document.getElementById('confirm-schedule-btn');
            const getStartedBtn = document.getElementById('get-started-btn');
            const submitBtn = document.getElementById('submit-btn');
            const lockoutBackBtn = document.getElementById('lockout-back-btn');
            const successBackBtn = document.getElementById('success-back-btn');
            const quizContainer = document.querySelector('#test-section .quiz-container');
            const lockoutView = document.getElementById('lockout-view');
            const successView = document.getElementById('success-view');
            const profilePicNavbar = document.getElementById('profile-pic');
            const profileSection = document.getElementById('profile-section');
            const profileCloseBtn = document.getElementById('profile-close-btn');


            function showSection(sectionId) {
                gsap.to([mainPageWrapper, ...contentSections], { opacity: 0, duration: 0.4, onComplete: () => {
                    mainPageWrapper.style.display = 'none';
                    contentSections.forEach(s => s.style.display = 'none');

                    const targetSection = document.getElementById(sectionId);
                    if (targetSection) {
                        targetSection.style.display = 'flex'; // Changed to flex for profile section
                        gsap.fromTo(targetSection, { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.4, delay: 0.1 });

                        if (sectionId === 'your-topic-section') {
                            topicView.style.display = 'block';
                            scheduleView.style.display = 'none';
                        } else if (sectionId === 'test-section') {
                            quizContainer.style.display = 'none';
                            lockoutView.style.display = 'none';
                            successView.style.display = 'none';
                            if (lastTestState === 'success') {
                                successView.style.display = 'flex';
                                gsap.fromTo(successView, { opacity: 0, y: 10 }, { opacity: 1, y: 0, duration: 0.3 });
                            } else if (lastTestState === 'lockout') {
                                lockoutView.style.display = 'flex';
                                gsap.fromTo(lockoutView, { opacity: 0, y: 10 }, { opacity: 1, y: 0, duration: 0.3 });
                            } else {
                                quizContainer.style.display = 'block';
                                gsap.fromTo(quizContainer, { opacity: 0, y: 10 }, { opacity: 1, y: 0, duration: 0.3 });
                            }
                        }
                    }
                }});
            }

            function showMainPage() {
                gsap.to([...contentSections, profileSection], { opacity: 0, duration: 0.4, onComplete: () => {
                    contentSections.forEach(s => s.style.display = 'none');
                    profileSection.style.display = 'none';
                    mainPageWrapper.style.display = 'flex';
                    gsap.to(mainPageWrapper, { opacity: 1, duration: 0.4, delay: 0.1 });
                }});
            }

            logoLink.addEventListener('click', (e) => { e.preventDefault(); showMainPage(); });
            const navbarHomeLinks = document.querySelectorAll('.floating-navbar a[href="#home"]');
            navbarHomeLinks.forEach(link => {
                link.addEventListener('click', (e) => { e.preventDefault(); showMainPage(); });
            });
            getStartedBtn.addEventListener('click', (e) => { e.preventDefault(); showSection('your-topic-section'); });
            yourTopicLink.addEventListener('click', (e) => { e.preventDefault(); showSection('your-topic-section'); });
            testLink.addEventListener('click', (e) => { e.preventDefault(); showSection('test-section'); });
            lockoutBackBtn.addEventListener('click', () => { showMainPage(); });
            successBackBtn.addEventListener('click', () => { showMainPage(); });

            // Event listener for profile photo in navbar
            profilePicNavbar.addEventListener('click', () => {
                updateProfileUI(mockUserData); // Ensure profile data is fresh
                showSection('profile-section');
            });

            // Event listener for closing profile section
            profileCloseBtn.addEventListener('click', () => {
                showMainPage(); // Or go back to the previous view, for now, back to home
            });


            document.querySelectorAll('.topic-tag:not(.topic-tag-add)').forEach(tag => {
                tag.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    const topicName = this.dataset.topic;
                    if (this.classList.contains('selected')) {
                        selectedTopics.add(topicName);
                    } else {
                        selectedTopics.delete(topicName);
                    }
                });
            });

            document.getElementById('add-new-topic-btn').addEventListener('click', () => {
                const newTopicInput = document.getElementById('new-topic-input');
                const feedbackMessage = document.getElementById('add-topic-feedback');
                const newTopic = newTopicInput.value.trim();
                if (newTopic) {
                    // Check if topic already exists to prevent duplicates
                    const existingTopicNames = mockUserData.savedTopics.map(t => t.name.toLowerCase());
                    if (!existingTopicNames.includes(newTopic.toLowerCase())) {
                        // For simplicity, assign a default time for new topics
                        mockUserData.savedTopics.push({ name: newTopic, time: "09:00" });
                        updateProfileUI(mockUserData); // Update profile to show new topic
                        newTopicInput.value = '';
                        feedbackMessage.style.opacity = '1';
                        setTimeout(() => { feedbackMessage.style.opacity = '0'; }, 2000);
                    } else {
                        alert('This topic already exists!');
                    }
                }
            });

            saveTopicsBtn.addEventListener('click', () => {
                document.getElementById('user-email').textContent = userData.email;
                
                // Update mockUserData.savedTopics based on current selectedTopics
                const newSavedTopics = Array.from(selectedTopics).map(topicName => {
                    // Try to find existing time for the topic, otherwise default to 09:00
                    const existingTopic = mockUserData.savedTopics.find(t => t.name === topicName);
                    return { name: topicName, time: existingTopic ? existingTopic.time : "09:00" };
                });
                mockUserData.savedTopics = newSavedTopics;
                
                gsap.to(topicView, { opacity: 0, duration: 0.3, onComplete: () => {
                    topicView.style.display = 'none';
                    scheduleView.style.display = 'block';
                    gsap.fromTo(scheduleView, {opacity: 0, y: 10}, {opacity: 1, y: 0, duration: 0.3});
                }});
            });

            confirmScheduleBtn.addEventListener('click', () => {
                const deliveryTime = document.getElementById('time-select').value;
                
                // Update the time for all currently selected topics in mockUserData.savedTopics
                mockUserData.savedTopics.forEach(topic => {
                    // If a topic is selected in the topic-selection-grid, update its time
                    // This assumes the user wants to set one time for all selected topics at this stage
                    if (selectedTopics.has(topic.name)) {
                        topic.time = deliveryTime;
                    }
                });

                alert(`Settings Confirmed!\nYour daily drops will be sent at ${formatTime(deliveryTime)}.`);
                updateProfileUI(mockUserData); // Update profile to reflect time change
                showMainPage();
            });

            submitBtn.addEventListener('click', function() {
                const selectedAnswer = userAnswers[0]; // Assuming only one question for simplicity
                if (!selectedAnswer) { alert('Please select an answer.'); return; }
                
                // Add answered class to quiz container to apply styling for answered state
                quizContainer.classList.add('answered');

                // Visually mark correct/incorrect answers
                const questionCard = document.querySelector('.question-card');
                const options = questionCard.querySelectorAll('.option');
                options.forEach(option => {
                    if (option.textContent === mockQuizData[0].correctAnswer) {
                        option.classList.add('correct');
                    } else if (option.classList.contains('selected')) {
                        option.classList.add('incorrect');
                    }
                });

                if (selectedAnswer === mockQuizData[0].correctAnswer) {
                    mockUserData.streak++;
                    updateProfileUI(mockUserData);
                    lastTestState = 'success';
                    gsap.to(quizContainer, {opacity: 0, duration: 0.3, onComplete: () => {
                        quizContainer.style.display = 'none';
                        successView.style.display = 'flex';
                        gsap.fromTo(successView, {opacity: 0, y: 10}, {opacity: 1, y: 0, duration: 0.3});
                    }});
                } else {
                    const lockoutEndTime = new Date().getTime() + 3600 * 1000; // 1 hour lockout
                    lastTestState = 'lockout';
                    showLockoutScreen(lockoutEndTime);
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            updateProfileUI(mockUserData);
            initializeTopicSelection(mockUserData.savedTopics);
            populateTimeSelect();
            const userAnswers = loadQuiz();
            setupEventListeners(mockUserData, userAnswers);
            runPageLoadAnimations();
            const feedbackMessage = document.getElementById('add-topic-feedback');
            if (feedbackMessage) feedbackMessage.style.opacity = '0';
        });
    </script>
</body>
</html>
